<!DOCTYPE html>
<html lang="th">

<head>
  <title>random color | asia-lb</title>
  <meta charset="utf-8" />
  <meta name="description" content="สุ่มเลือกสีของคุณ" />
  <meta name="keywords" content="HTML,CSS,XML,JavaScript" />
  <meta name="author" content="Centered101" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="project-test-submission.web.app" />
  <meta property="og:title" content="Centered101" />
  <meta property="og:description" content="สุ่มเลือกสีของคุณ" />
  <meta property="og:image" content="./images/logo3.ico" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="project-test-submission.web.app" />
  <meta property="twitter:title" content="Centered101" />
  <meta property="twitter:description" content="สุ่มเลือกสีของคุณ" />
  <meta property="twitter:image" content="./images/logo3.ico" />

  <!-- รูปโปรไฟล์หัวข้อหน้าเว็บ -->
  <link id="favicon" rel="icon" type="image/png" href="./images/logo3.ico" />

  <link rel="stylesheet" href="./style/style.css" />
  <link rel="stylesheet" href="./style/random_color.css" />
</head>

<body>
  <form id="surveyForm" method="post" action="https://script.google.com/macros/s/AKfycbwXvZYX5TyRZUQ7k_O4pLj_TgpqrwrS4lRqd1TisYAI8ZNOP95E0331MiC_Guosuw0i/exec">
    <section class="section-1">
      <div class="container_username">
        <div class="profile">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#000000" width="25px" height="25px">
            <path d="M0 0h24v24H0z" fill="none"></path>
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path>
          </svg>
        </div>
        <input type="text" name="username" placeholder="ใส่ชื่อ - นามสกุล" maxlength="20" required />
        <button type="button" onclick="showSection2()">ตกลง</button>
        <div id="submitDiv" style="display: none;">กำลังส่ง...</div>
      </div>
    </section>

    <section class="section-2" style="display: none;">
      <div class="container_randomColor">
        <img src="./images/logo3.ico" style="width: 90px; height: 90px; object-fit: contain; object-position: center;"
          width="90" height="90" fetchpriority="high">

        <h1 id="displayUsername">สุ่มสีของคุณ: พงศ์พล พรมผา</h1>

        <div id="container_color">
          <div id="blue" class="color_box" title="สีน้ำเงิน"></div>
          <div id="red" class="color_box" title="สีแดง"></div>
        </div>

        <div class="container_box">
          <button type="button" id="randomButton" title="สุ่มสี" onclick="randomizeColor()">
            <span class="back"></span>
            <span class="front">สุ่ม</span>
          </button>
          <button type="button" class="hidden" id="confirmButton" title="ตกลง" onclick="location.href='./about.html'">
            <span class="back"></span>
            <span class="front">ตกลง</span>
          </button>

          <p id="result">1</p>
          <p id="stats">1</p>
        </div>
      </div>
    </section>
  </form>

  <script>
    function showSection2() {
      const requiredFields = document.querySelectorAll('.section-1 input[required]');
      let allFilled = true;

      requiredFields.forEach(function (field) {
        if (!field.value) {
          allFilled = false;
          field.style.borderColor = '#ff0000';
        } else {
          field.style.borderColor = '#0056b3';
        }
      });

      if (allFilled) {
        document.querySelector('.section-1').style.display = 'none';
        document.querySelector('.section-2').style.display = 'block';

        document.querySelector('input[name="username"]').style.display = "none";
        document.querySelector('button[type="button"]').style.display = "none";
        document.getElementById('submitDiv').style.display = "block";

        updateSectionTracker(2);
      } else {
        alert('กรุณากรอกข้อมูลให้ครบถ้วน');
      }
    }

    let isRandomized = false;
    let redCount = 0;
    let blueCount = 0;
    const totalPeople = 200;

    function randomizeColor() {
      if (isRandomized) {
        alert("คุณได้สุ่มสีไปแล้ว!");
        return;
      }

      document.getElementById("randomButton").style.display = "none";

      const colorBox = document.getElementById("container_color");
      const result = document.getElementById("result");
      const stats = document.getElementById("stats");
      const selectedColorInput = document.getElementById("selectedColor");
      let counter = 0;

      const interval = setInterval(() => {
        if (counter < 10) {
          colorBox.innerHTML =
            Math.random() < 0.5
              ? '<div id="blue" class="color_box selected" title="สีน้ำเงิน"></div><div id="red" class="color_box unselected" title="สีแดง"></div>'
              : '<div id="blue" class="color_box unselected" title="สีน้ำเงิน"></div><div id="red" class="color_box selected" title="สีแดง"></div>';
          counter++;
        } else {
          clearInterval(interval);

          const selectedColor = Math.random() < 0.5 ? "แดง" : "น้ำเงิน";
          result.textContent = `คุณสุ่มได้: สี${selectedColor}`;
          selectedColorInput.value = selectedColor;

          if (selectedColor === "แดง") {
            redCount++;
          } else {
            blueCount++;
          }

          document.getElementById("red").classList.remove("unselected");
          document.getElementById("blue").classList.remove("unselected");

          if (selectedColor === "แดง") {
            document.getElementById("red").classList.add("selected");
            document.getElementById("blue").classList.add("hidden");
          } else {
            document.getElementById("blue").classList.add("selected");
            document.getElementById("red").classList.add("hidden");
          }

          stats.textContent = `สถิติ: สีแดง ${redCount}, สีน้ำเงิน ${blueCount} จาก ${totalPeople} คน`;
          document.getElementById("confirmButton").classList.remove("hidden");

          document.body.style.backgroundColor =
            selectedColor === "แดง" ? "#FE4040" : "#409EFE";

          isRandomized = true;
        }
      }, 1000);
    }

    document.getElementById("surveyForm").addEventListener("submit", (e) => {
      e.preventDefault();

      fetch("https://script.google.com/macros/s/AKfycbzzF-GNwZW3h99qiqKZRXcLxtZp4r-VEFcx7PE5FI-k8FxTr7G2wwZ_s9bBw6K5AkgE/exec", {
        method: "POST",
        body: new FormData(document.getElementById("surveyForm"))
      })
        .then((response) => {
          alert("ขอบคุณ! แบบฟอร์มของคุณถูกส่งเรียบร้อยแล้ว");
          window.location.reload();
        })
        .catch((error) => {
          handleError(error);
        });
    });

    function handleError(error) {
      console.error("Error!", error.message);

      document.querySelector('input[name="username"]').style.display = "block";
      document.querySelector('button[type="button"]').style.display = "block";
      document.getElementById('submitDiv').style.display = "none";
    }
  </script>
</body>

</html>
